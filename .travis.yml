language: go
env:
  global:
    - GO111MODULE=on
    - secure: x5sOP6latIVui3U6+2s82eiHYTfQokYwtygmqFjWNAWhWmiHh+ylArylYN9IMRb15PqlsNtBJVUYb6Q1+ZkC6/3d7IXyITh7RpQ55hi4QISF6ve1/X0mOTrO2FO97WDsc4dHGq8WxGTNyBlgqPqmBAYH2tKmn7ZdYAqJwbiWGJDX/Q03DssqePvn9W5TrbTBFU6RXLFpX/6dk7UaxCM5O+qUji1MJJ2nNBmHHAXZmTdnRtSYt275MzXjrnd4nsEkLYVMQs58HeLIpemzC0vJ/73OQK7zo9U5tdti8+J9+/sH14tSrwjTv8BCwy3YWKnEmqx/alf4nS/O9BxBnYDFUIxCpZqqzoskMiZFy59EjWE3lI9LIjo35I6GDvxQsSgvhQR1ZwuBmaoAYDqiyqDJ7fIz9OItN7QuHuc36RgNE9xbbCPGjrtYpTAZJoWm5qT8qAI+vxJl8U1T6Eabe/ADGktYxDNZx4KT/8tG42srjpHpcRmLOMNAGiVQxXZWJB5oHTqAgh4yxUjoT+bGOsg+hM1+dqfI72bxZ/rj5FssYTENJr7CxOYy9LFd8Z8bKJ8HlKeL+KbzQBq/2Gra/jFmFLGgVtsaoq1NN/p7N2/OaclfJNSJh27NhM4EMK2AiD8imoiLOWpzksUbGfXE9Tx69A9LDsQPOrSApcZK1loq6rs=

go:
  - 1.13.x
before_install:
  - make install_tools
install:
  - make get-deps
script:
  - make build
  - make test
  - make coveralls
after_success:
  - gox -ldflags "-X github.com/derphilipp/gomar/version.GitCommit=${GIT_COMMIT}${GIT_DIRTY} -X github.com/derphilipp/gomar/version.BuildDate=${BUILD_DATE}" -output "dist/{{.OS}}_{{.Arch}}_{{.Dir}}"
  - ghr --username tcnksm-sample --token $GITHUB_TOKEN --replace --prerelease --debug pre-release dist/

deploy:
  provider: releases
  token: PFA5GgSje/Vc/0hifjdBt07X3MNyA3gCuqImhOF5L/yQPU3x0ZbGlw+Gj/v6XZMKBuhxVDMtTkTQkAta4SA6yopl636RgqhlF8kxCZ+KiE+yvljeSONrI8NUWtk48wvzjJIxctqBFjDURAzALWhAKu4qxpZjXhYvRUbWq3cDh2C5bsP+O1ZNE8OvVx4besvk/ykls2U1i97f4n5zTkmI24dupFtnE4gfx241TbDmMN7zCG18BCekGJoC+weYnh3iYDEzyTDhGvNyiRyW4qQVQCp2c2hLn+zvKooMIZ+l5xUe8WoiAD3XNgsf1o2MK1Mq+erySSYXo4Uz+jt9gB5cvnd11DqXxGhfgiQg1MR0bz7tI6Jy2xdC+lyut8koExUKS6sPP5za+MRxwgVtYjNd6ZJHuy+RthVED9r3F8hFCLwlRCBwsSYpyhRHDnOKCHA0eEQ/N/q21IlhgkzudCRLPXZxoNGXhbgfR3TBGGJ+6yBDzcHW/UAJDbWR3+eLKNHo2UWjYSjX2ksj77ngPAYeL5CeV8WeqH7Y+Y2tsPYTiWtsrDL6GCQaSbEPGki1T8sk6k+/QkiEGt4yjDeK2+uxBFUwnHACDPcvRnPls/E5XfXVxWCWuNNt2AD8wFpmcFthaYr1LqcI5o59nibP2Cxm6Dc6FyruKcmY48nx5coxeck=
  file_glob: dist/*
  on:
    tags: true
